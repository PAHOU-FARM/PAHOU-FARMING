<!-- templates/accounts/password_reset_admin.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Réinitialisation du mot de passe – Code administrateur</title>

  <!-- Empêcher cache / auto-sauvegarde -->
  <meta name="robots" content="noindex, nofollow">
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="autocomplete" content="off">
  <meta name="autocapitalize" content="none">
  <meta name="autocorrect" content="off">

  <!-- CDNs -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

  <!-- Styles communs -->
  <link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>
<body>
<div class="layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <i class="fa-solid fa-seedling fa-lg" aria-hidden="true"></i>
      <h1>Ferme MG Pahou</h1>
    </div>
    <nav class="menu" role="navigation" aria-label="Navigation latérale">
      <p class="title">Compte</p>
      <a class="nav-link" href="{% url 'accounts:login' %}">
        <i class="fa-solid fa-right-to-bracket" aria-hidden="true"></i> Connexion
      </a>
      <a class="nav-link" href="{% url 'accueil' %}">
        <i class="fa-solid fa-house" aria-hidden="true"></i> Accueil
      </a>
    </nav>
  </aside>

  <!-- Contenu -->
  <main class="content">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h4 mb-0">Réinitialisation du mot de passe</h1>
      <div class="btn-toolbar gap-2">
        <a class="btn btn-outline-secondary btn-sm" href="{% url 'accounts:login' %}">
          <i class="fa-solid fa-right-to-bracket me-1" aria-hidden="true"></i> Connexion
        </a>
        <a class="btn btn-outline-secondary btn-sm" href="{% url 'accueil' %}">
          <i class="fa-solid fa-house me-1" aria-hidden="true"></i> Accueil
        </a>
      </div>
    </div>

    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} mb-3" role="alert">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <div class="card shadow-sm" style="max-width: 680px;">
      <div class="card-body">
        <p class="text-muted small mb-4">
          Cette opération est protégée par un <strong>code administrateur</strong>.
          Si vous êtes connecté avec un compte <em>staff</em>, ce code n’est pas requis.
          Un message neutre s’affichera, qu’un e-mail existe ou non.
        </p>

        <form method="post" autocomplete="off" novalidate>
          {% csrf_token %}
          <div class="row g-3">
            {# Affiche le champ code SI l'utilisateur n'est pas staff (ou non connecté) #}
            {% if not request.user.is_authenticated or not request.user.is_staff %}
              <div class="col-md-6">
                <label for="id_admin_code" class="form-label">Code administrateur</label>
                <div class="input-group">
                  <input
                    type="password"
                    id="id_admin_code"
                    name="admin_code"
                    class="form-control"
                    required
                    autocomplete="off"
                    autocorrect="off"
                    autocapitalize="none"
                    spellcheck="false">
                  <button class="btn btn-outline-secondary" type="button" id="toggleAdminCode" aria-label="Afficher/Masquer le code">
                    <i class="fa-regular fa-eye"></i>
                  </button>
                </div>
              </div>
            {% endif %}

            <div class="col-md-6">
              <label for="id_email" class="form-label">E-mail de l’utilisateur</label>
              <input
                type="email"
                id="id_email"
                name="email"
                class="form-control"
                value="{{ email|default:'' }}"
                required
                autocomplete="off"
                autocorrect="off"
                autocapitalize="none"
                spellcheck="false">
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mt-4">
            <a href="{% url 'accounts:login' %}" class="small">
              <i class="fa-solid fa-right-to-bracket me-1" aria-hidden="true"></i> Retour à la connexion
            </a>
            <button type="submit" class="btn btn-primary">
              <i class="fa-solid fa-envelope me-1" aria-hidden="true"></i> Envoyer le lien de réinitialisation
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>
</div>

<script>
  // Bouton "œil" pour le code administrateur (si présent dans le DOM)
  (function () {
    var btn = document.getElementById('toggleAdminCode');
    var input = document.getElementById('id_admin_code');
    if (!btn || !input) return;
    btn.addEventListener('click', function () {
      var isPwd = input.type === 'password';
      input.type = isPwd ? 'text' : 'password';
      btn.innerHTML = isPwd
        ? '<i class="fa-regular fa-eye-slash"></i>'
        : '<i class="fa-regular fa-eye"></i>';
    });
  })();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
